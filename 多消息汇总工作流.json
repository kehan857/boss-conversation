{
  "nodes": [
    {
      "nodeId": "userInput",
      "name": "ç”¨æˆ·è¾“å…¥",
      "type": "userInput",
      "flowNodeType": "userInput",
      "position": {
        "x": 326.25,
        "y": 90.5
      },
      "inputs": [],
      "outputs": [
        {
          "key": "userChatInput",
          "targets": [
            {
              "nodeId": "handleMultiMessage",
              "key": "userMessage"
            }
          ],
          "type": "static",
          "label": "ç”¨æˆ·è¾“å…¥",
          "valueType": "string"
        }
      ]
    },
    {
      "nodeId": "handleMultiMessage",
      "name": "å¤šæ¶ˆæ¯æ±‡æ€»å¤„ç†",
      "type": "plugin",
      "flowNodeType": "plugin",
      "position": {
        "x": 327.25,
        "y": 220.5
      },
      "inputs": [
        {
          "key": "userMessage",
          "type": "string",
          "value": "",
          "label": "ç”¨æˆ·æ¶ˆæ¯",
          "connected": true,
          "renderTypeList": ["textarea", "reference"],
          "valueType": "string",
          "required": true
        },
        {
          "key": "messageHistory",
          "type": "array",
          "value": [],
          "label": "æ¶ˆæ¯å†å²",
          "connected": false,
          "renderTypeList": ["input", "reference"],
          "valueType": "array"
        },
        {
          "key": "lastMessageTime",
          "type": "number",
          "value": 0,
          "label": "ä¸Šæ¬¡æ¶ˆæ¯æ—¶é—´",
          "connected": false,
          "renderTypeList": ["numberInput", "reference"],
          "valueType": "number"
        },
        {
          "key": "messageThreshold",
          "type": "number",
          "value": 10,
          "label": "æ¶ˆæ¯æ•°é˜ˆå€¼",
          "connected": false,
          "renderTypeList": ["numberInput", "reference"],
          "valueType": "number"
        },
        {
          "key": "timeThreshold",
          "type": "number",
          "value": 5000,
          "label": "æ—¶é—´é˜ˆå€¼",
          "connected": false,
          "renderTypeList": ["numberInput", "reference"],
          "valueType": "number"
        },
        {
          "key": "messageCount",
          "type": "number",
          "value": 0,
          "label": "æ¶ˆæ¯è®¡æ•°",
          "connected": true,
          "renderTypeList": ["numberInput", "reference"],
          "valueType": "number"
        }
      ],
      "outputs": [
        {
          "key": "shouldReply",
          "targets": [
            {
              "nodeId": "replyControl",
              "key": "condition"
            }
          ],
          "type": "static",
          "label": "æ˜¯å¦å›å¤",
          "valueType": "boolean"
        },
        {
          "key": "updatedMessageHistory",
          "targets": [
            {
              "nodeId": "globalMessageHistory",
              "key": "value"
            }
          ],
          "type": "static",
          "label": "æ›´æ–°åçš„æ¶ˆæ¯å†å²",
          "valueType": "array"
        },
        {
          "key": "combinedMessage",
          "targets": [
            {
              "nodeId": "replyControl",
              "key": "combinedMessages"
            }
          ],
          "type": "static",
          "label": "åˆå¹¶åçš„æ¶ˆæ¯",
          "valueType": "string"
        },
        {
          "key": "lastMessageTime",
          "targets": [
            {
              "nodeId": "globalLastMsgTime",
              "key": "value"
            }
          ],
          "type": "static",
          "label": "ä¸Šæ¬¡æ¶ˆæ¯æ—¶é—´",
          "valueType": "number"
        },
        {
          "key": "messageCount",
          "targets": [
            {
              "nodeId": "globalMessageCount",
              "key": "value"
            }
          ],
          "type": "static",
          "label": "æ›´æ–°åçš„æ¶ˆæ¯è®¡æ•°",
          "valueType": "number"
        }
      ],
      "pluginId": "å¤šæ¶ˆæ¯æ±‡æ€»æ’ä»¶",
      "pluginType": "plugin",
      "showStatus": true
    },
    {
      "nodeId": "globalMessageHistory",
      "name": "æ¶ˆæ¯å†å²(å…¨å±€å˜é‡)",
      "type": "variable",
      "flowNodeType": "variable",
      "position": {
        "x": 137.25,
        "y": 350.5
      },
      "inputs": [
        {
          "key": "value",
          "type": "array",
          "value": [],
          "label": "å˜é‡å€¼",
          "connected": true,
          "valueType": "array"
        }
      ],
      "outputs": [
        {
          "key": "value",
          "targets": [
            {
              "nodeId": "handleMultiMessage",
              "key": "messageHistory"
            }
          ],
          "type": "static",
          "label": "å˜é‡å€¼",
          "valueType": "array"
        }
      ],
      "variableId": "messageHistory",
      "variableType": "global"
    },
    {
      "nodeId": "globalLastMsgTime",
      "name": "ä¸Šæ¬¡æ¶ˆæ¯æ—¶é—´(å…¨å±€å˜é‡)",
      "type": "variable",
      "flowNodeType": "variable",
      "position": {
        "x": 137.25,
        "y": 480.5
      },
      "inputs": [
        {
          "key": "value",
          "type": "number",
          "value": 0,
          "label": "å˜é‡å€¼",
          "connected": true,
          "valueType": "number"
        }
      ],
      "outputs": [
        {
          "key": "value",
          "targets": [
            {
              "nodeId": "handleMultiMessage",
              "key": "lastMessageTime"
            }
          ],
          "type": "static",
          "label": "å˜é‡å€¼",
          "valueType": "number"
        }
      ],
      "variableId": "lastMessageTime",
      "variableType": "global"
    },
    {
      "nodeId": "globalMessageCount",
      "name": "æ¶ˆæ¯è®¡æ•°(å…¨å±€å˜é‡)",
      "type": "variable",
      "flowNodeType": "variable",
      "position": {
        "x": 137.25,
        "y": 610.5
      },
      "inputs": [
        {
          "key": "value",
          "type": "number",
          "value": 0,
          "label": "å˜é‡å€¼",
          "connected": true,
          "valueType": "number"
        }
      ],
      "outputs": [
        {
          "key": "value",
          "targets": [
            {
              "nodeId": "handleMultiMessage",
              "key": "messageCount"
            }
          ],
          "type": "static",
          "label": "å˜é‡å€¼",
          "valueType": "number"
        }
      ],
      "variableId": "messageCount",
      "variableType": "global"
    },
    {
      "nodeId": "replyControl",
      "name": "å›å¤æ§åˆ¶",
      "type": "condition",
      "flowNodeType": "condition",
      "position": {
        "x": 529.25,
        "y": 350.5
      },
      "inputs": [
        {
          "key": "condition",
          "type": "boolean",
          "value": false,
          "label": "æ¡ä»¶",
          "connected": true,
          "valueType": "boolean",
          "renderTypeList": ["switch", "reference"]
        },
        {
          "key": "combinedMessages",
          "type": "string",
          "value": "",
          "label": "åˆå¹¶æ¶ˆæ¯",
          "connected": true,
          "valueType": "string",
          "renderTypeList": ["textarea", "reference"]
        }
      ],
      "outputs": [
        {
          "key": "true",
          "targets": [
            {
              "nodeId": "aiReply",
              "key": "userChatInput"
            }
          ],
          "type": "static",
          "label": "æ¡ä»¶ä¸ºçœŸ",
          "valueType": "any"
        },
        {
          "key": "false",
          "targets": [],
          "type": "static",
          "label": "æ¡ä»¶ä¸ºå‡",
          "valueType": "any"
        }
      ]
    },
    {
      "nodeId": "aiReply",
      "name": "AIå›å¤",
      "type": "chatNode",
      "flowNodeType": "chatNode",
      "position": {
        "x": 529.25,
        "y": 480.5
      },
      "inputs": [
        {
          "key": "userChatInput",
          "type": "string",
          "value": "",
          "label": "ç”¨æˆ·è¾“å…¥",
          "connected": true,
          "valueType": "string",
          "renderTypeList": ["textarea", "reference"],
          "required": true
        },
        {
          "key": "systemPrompt",
          "type": "string",
          "value": "ä½ æ˜¯ä¸€ä¸ªé”€å”®åŠ©æ‰‹ï¼Œè¯·æ ¹æ®ç”¨æˆ·çš„å¤šæ¡æ¶ˆæ¯å†…å®¹ï¼Œç»¼åˆåˆ†æå¹¶å›å¤ã€‚",
          "label": "ç³»ç»Ÿæç¤ºè¯",
          "connected": false,
          "valueType": "string",
          "renderTypeList": ["textarea", "reference"]
        },
        {
          "key": "history",
          "type": "chatHistory",
          "value": [],
          "label": "èŠå¤©å†å²",
          "connected": false,
          "valueType": "chatHistory",
          "renderTypeList": ["numberInput", "reference"]
        },
        {
          "key": "quoteQA",
          "type": "datasetQuote",
          "value": [],
          "label": "å¼•ç”¨å†…å®¹",
          "connected": false,
          "valueType": "datasetQuote",
          "renderTypeList": ["settingDatasetQuotePrompt"]
        },
        {
          "key": "model",
          "type": "string",
          "value": "",
          "label": "æ¨¡å‹",
          "connected": false,
          "valueType": "string",
          "renderTypeList": ["settingLLMModel", "reference"]
        },
        {
          "key": "temperature",
          "type": "number",
          "value": 0,
          "label": "æ¸©åº¦",
          "connected": false,
          "valueType": "number",
          "renderTypeList": ["numberInput", "reference"]
        },
        {
          "key": "maxToken",
          "type": "number",
          "value": 0,
          "label": "æœ€å¤§Token",
          "connected": false,
          "valueType": "number",
          "renderTypeList": ["numberInput", "reference"]
        }
      ],
      "outputs": [
        {
          "key": "answerText",
          "targets": [
            {
              "nodeId": "output",
              "key": "answerText"
            }
          ],
          "type": "static",
          "label": "AIå›å¤å†…å®¹",
          "valueType": "string",
          "required": true
        },
        {
          "key": "history",
          "targets": [],
          "type": "static",
          "label": "æ–°çš„ä¸Šä¸‹æ–‡",
          "valueType": "chatHistory",
          "required": true
        }
      ]
    },
    {
      "nodeId": "output",
      "name": "å¯¹è¯è¾“å‡º",
      "type": "output",
      "flowNodeType": "output",
      "position": {
        "x": 529.25,
        "y": 610.5
      },
      "inputs": [
        {
          "key": "answerText",
          "type": "string",
          "value": "",
          "label": "å›å¤å†…å®¹",
          "connected": true,
          "valueType": "string",
          "required": true
        }
      ],
      "outputs": []
    }
  ],
  "edges": [
    {
      "source": "userInput",
      "target": "handleMultiMessage",
      "sourceHandle": "userChatInput",
      "targetHandle": "userMessage"
    },
    {
      "source": "handleMultiMessage",
      "target": "replyControl",
      "sourceHandle": "shouldReply",
      "targetHandle": "condition"
    },
    {
      "source": "handleMultiMessage",
      "target": "globalMessageHistory",
      "sourceHandle": "updatedMessageHistory",
      "targetHandle": "value"
    },
    {
      "source": "handleMultiMessage",
      "target": "replyControl",
      "sourceHandle": "combinedMessage",
      "targetHandle": "combinedMessages"
    },
    {
      "source": "handleMultiMessage",
      "target": "globalLastMsgTime",
      "sourceHandle": "lastMessageTime",
      "targetHandle": "value"
    },
    {
      "source": "handleMultiMessage",
      "target": "globalMessageCount",
      "sourceHandle": "messageCount",
      "targetHandle": "value"
    },
    {
      "source": "globalMessageHistory",
      "target": "handleMultiMessage",
      "sourceHandle": "value",
      "targetHandle": "messageHistory"
    },
    {
      "source": "globalLastMsgTime",
      "target": "handleMultiMessage",
      "sourceHandle": "value",
      "targetHandle": "lastMessageTime"
    },
    {
      "source": "globalMessageCount",
      "target": "handleMultiMessage",
      "sourceHandle": "value",
      "targetHandle": "messageCount"
    },
    {
      "source": "replyControl",
      "target": "aiReply",
      "sourceHandle": "true",
      "targetHandle": "userChatInput"
    },
    {
      "source": "aiReply",
      "target": "output",
      "sourceHandle": "answerText",
      "targetHandle": "answerText"
    }
  ],
  "metadata": {
    "name": "å¤šæ¶ˆæ¯æ±‡æ€»é”€å”®æ™ºèƒ½ä½“",
    "description": "å½“å®¢æˆ·çŸ­æ—¶é—´å†…å‘é€å¤šæ¡æ¶ˆæ¯æ—¶ï¼Œé¿å…æ‰“æ–­å®¢æˆ·çš„è¡¨è¾¾ï¼Œç­‰å¾…å®¢æˆ·è¾“å…¥å®Œæˆåå†ç»Ÿä¸€å›å¤",
    "avatar": "ğŸ’¬",
    "updateTime": 1714373724984,
    "pluginVersion": "1.0.0",
    "type": "chat",
    "version": "1.0",
    "appType": "chat",
    "flowNodeType": "root",
    "variables": [
      {
        "id": "messageHistory",
        "key": "messageHistory",
        "type": "array",
        "defaultValue": [],
        "label": "æ¶ˆæ¯å†å²",
        "valueType": "array"
      },
      {
        "id": "lastMessageTime",
        "key": "lastMessageTime",
        "type": "number",
        "defaultValue": 0,
        "label": "ä¸Šæ¬¡æ¶ˆæ¯æ—¶é—´",
        "valueType": "number"
      },
      {
        "id": "messageCount",
        "key": "messageCount",
        "type": "number",
        "defaultValue": 0,
        "label": "æ¶ˆæ¯è®¡æ•°",
        "valueType": "number"
      }
    ]
  },
  "runningTime": 17
} 